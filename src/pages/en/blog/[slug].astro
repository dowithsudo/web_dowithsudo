---
import { getCollection, render } from 'astro:content';
import BlogPost from '@/layouts/BlogPost.astro';

export async function getStaticPaths() {
  const posts = await getCollection('blog', ({ id }) => id.startsWith('en/'));
  
  return posts.map(post => {
    // Robust slug logic for 'en' folder
    const slug = post.id
      .replace(/^en\//, '')
      .replace(/\/index\.(md|mdx)$/, '')
      .replace(/\.(md|mdx)$/, '');

    return {
      params: { slug },
      props: { post },
    };
  });
}

const { post } = Astro.props;

// Render konten sekaligus ambil 'headings' buat Table of Contents (ToC)
const { Content, headings } = await render(post);

// Format tanggal versi English
const formattedDate = post.data.date.toLocaleDateString('en-US', {
  year: 'numeric',
  month: 'long',
  day: 'numeric'
});
---

<BlogPost 
  {...post.data} 
  pubDate={formattedDate} 
  headings={headings}
>
  <Content />
</BlogPost>