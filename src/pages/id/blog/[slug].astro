---
import { getCollection, render } from 'astro:content';
import BlogPost from '@/layouts/BlogPost.astro'; // Ganti ke layout baru

export async function getStaticPaths() {
  const posts = await getCollection('blog', ({ id }) => id.startsWith('id/'));
  
  return posts.map(post => {
    const slug = post.id
      .replace(/^id\//, '')
      .replace(/\/index\.(md|mdx)$/, '')
      .replace(/\.(md|mdx)$/, '');

    return {
      params: { slug },
      props: { post },
    };
  });
}

const { post } = Astro.props;

// Render konten sekaligus ambil 'headings' buat Daftar Isi
const { Content, headings } = await render(post);

// Konversi tanggal ke format teks biar layout gak bingung
const formattedDate = post.data.date.toLocaleDateString('id-ID', {
  year: 'numeric',
  month: 'long',
  day: 'numeric'
});
---

<BlogPost 
  {...post.data} 
  pubDate={formattedDate} 
  headings={headings}
>
  <Content />
</BlogPost>